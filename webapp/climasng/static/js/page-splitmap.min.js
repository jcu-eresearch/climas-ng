!function t(e,i,a){function n(o,l){if(!i[o]){if(!e[o]){var r="function"==typeof require&&require;if(!l&&r)return r(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var p=i[o]={exports:{}};e[o][0].call(p.exports,function(t){var i=e[o][1][t];return n(i?i:t)},p,p.exports,t,e,i,a)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<a.length;o++)n(a[o]);return n}({1:[function(t,e,i){t("./mapview/main"),t("./menusandpanels"),$(function(){$("nav > ul").mspp({})})},{"./mapview/main":2,"./menusandpanels":6}],2:[function(t,e,i){(function(){var e;window.console||(window.console={log:function(){return{}}}),e=t("./views/app"),$(function(){var t;return t=new e,t.render()})}).call(this)},{"./views/app":5}],3:[function(t,e,i){(function(){var t;t=Backbone.Model.extend({constructor:function(t,e,i){return this.shortName=t,this.longName=e,this.path=i,null}}),e.exports=t}).call(this)},{}],4:[function(t,e,i){(function(){var t=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};Array.prototype.forEach||(Array.prototype.forEach=function(e,i){var a,n,s,o;for(o=[],a=n=0,s=this.length;s>=0?s>=n:n>=s;a=s>=0?++n:--n)o.push(t.call(this,a)>=0?e.call(i,this[a],a,this):void 0);return o}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e,i,a;for(e=i=0,a=this.length;a>=0?a>=i:i>=a;e=a>=0?++i:--i)if(this[e]===t)return e;return-1}),String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return this.substr(e||0,t.length)===t})}).call(this)},{}],5:[function(t,e,i){(function(){var i,a,n;a=t("../models/maplayer"),t("../util/shims"),n=function(t,e){var i,a,n,s;return i=["verydebug","debug","message","warning"],e||(e="debug"),n="debug",s=i.indexOf(n),a=i.indexOf(e),s>a?void 0:t+""===t?console.log("["+e+"] "+t):console.log(t)},i=Backbone.View.extend({tagName:"div",className:"splitmap showforms",id:"splitmap",speciesDataUrl:window.mapConfig.speciesDataUrl,climateDataUrl:window.mapConfig.climateDataUrl,summariesDataUrl:window.mapConfig.summariesDataUrl,biodivDataUrl:window.mapConfig.biodivDataUrl,rasterApiUrl:window.mapConfig.rasterApiUrl,trackSplitter:!1,trackPeriod:100,events:{"click .btn-change":"toggleForms","click .btn-compare":"toggleSplitter","click .btn-copy.left-valid-map":"copyMapLeftToRight","click .btn-copy.right-valid-map":"copyMapRightToLeft",leftmapupdate:"leftSideUpdate",rightmapupdate:"rightSideUpdate","change select.left":"leftSideUpdate","change select.right":"rightSideUpdate","change input.left":"leftSideUpdate","change input.right":"rightSideUpdate","change #sync":"toggleSync"},tick:function(){return n("tick"),setTimeout(this.tick,1e3)},initialize:function(){return n("AppView.initialize"),_.bindAll.apply(_,[this].concat(_.functions(this))),this.nameIndex={},this.mapList={}},render:function(){return n("AppView.render"),this.$el.append(i.templates.layout({leftTag:i.templates.leftTag(),rightTag:i.templates.rightTag(),leftForm:i.templates.leftForm(),rightForm:i.templates.rightForm()})),$("#contentwrap").append(this.$el),this.map=L.map("map",{center:[0,0],zoom:2}),this.map.on("move",this.resizeThings),L.control.scale().addTo(this.map),this.legend=L.control({uri:""}),this.legend.onAdd=function(t){return function(e){return t._div=L.DomUtil.create("div","info")}}(this),this.legend.update=function(t){return function(e){return t._div.innerHTML='<object type="image/svg+xml" data="'+(e?e.uri:".")+'" />'}}(this),this.legend.addTo(this.map),L.tileLayer("//server.arcgisonline.com/ArcGIS/rest/services/{variant}/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri",variant:"World_Topo_Map"}).addTo(this.map),this.leftForm=this.$(".left.form"),this.buildForm("left"),this.rightForm=this.$(".right.form"),this.buildForm("right"),this.leftTag=this.$(".left.tag"),this.rightTag=this.$(".right.tag"),this.splitLine=this.$(".splitline"),this.splitThumb=this.$(".splitthumb"),this.leftSideUpdate(),this.rightSideUpdate(),this.toggleSplitter()},resolvePlaceholders:function(t,e){var i,a,n,s;i=t,i=i.replace(/\{\{\s*location.protocol\s*\}\}/g,location.protocol),i=i.replace(/\{\{\s*location.host\s*\}\}/g,location.host),i=i.replace(/\{\{\s*location.hostname\s*\}\}/g,location.hostname);for(a in e)s=e[a],n=new RegExp("\\{\\{\\s*"+a+"\\s*\\}\\}","g"),i=i.replace(n,s);return i},copyMapLeftToRight:function(){return n("AppView.copyMapLeftToRight"),this.leftInfo?(this.$("#rightmapspp").val(this.leftInfo.mapName),this.$("#rightmapyear").val(this.leftInfo.year),this.$("input[name=rightmapscenario]").each(function(t){return function(e,i){return $(i).prop("checked",$(i).val()===t.leftInfo.scenario)}}(this)),this.$("#rightmapgcm").val(this.leftInfo.gcm),this.rightSideUpdate()):void 0},copyMapRightToLeft:function(){return n("AppView.copyMapRightToLeft"),this.rightInfo?(this.$("#leftmapspp").val(this.rightInfo.mapName),this.$("#leftmapyear").val(this.rightInfo.year),this.$("input[name=leftmapscenario]").each(function(t){return function(e,i){return $(i).prop("checked",$(i).val()===t.rightInfo.scenario)}}(this)),this.$("#leftmapgcm").val(this.rightInfo.gcm),this.leftSideUpdate()):void 0},sideUpdate:function(t){var e,i,a;return n("AppView.sideUpdate ("+t+")"),a={mapName:this.$("#"+t+"mapspp").val(),degs:this.$("#"+t+"mapdegs").val(),range:this.$("input[name="+t+"maprange]:checked").val(),confidence:this.$("#"+t+"mapconfidence").val()},e="baseline"===a.degs,this.$("input[name="+t+"maprange], #"+t+"mapconfidence").prop("disabled",e),this.$("."+t+".side.form fieldset").removeClass("disabled"),this.$("input[name^="+t+"]:disabled, [id^="+t+"]:disabled").closest("fieldset").addClass("disabled"),a.mapName in this.nameIndex?(this.$("."+t+"-valid-map").removeClass("disabled").prop("disabled",!1),i="left"===t?this.leftInfo:this.rightInfo,i&&_.isEqual(a,i)?!1:i&&a.mapName===i.mapName&&a.degs===i.degs&&"baseline"===a.degs?!1:("left"===t?this.leftInfo=a:this.rightInfo=a,this.addMapLayer(t),this.addMapTag(t))):(this.$("."+t+"-valid-map").addClass("disabled").prop("disabled",!0),!1)},leftSideUpdate:function(){return this.sideUpdate("left"),this.$("#sync")[0].checked?(n("Sync checked - syncing right side","message"),this.copySppToRightSide()):void 0},rightSideUpdate:function(){return this.sideUpdate("right")},copySppToRightSide:function(){return this.$("#rightmapspp").val(this.$("#leftmapspp").val()),this.rightSideUpdate()},addMapTag:function(t){var e,i,a;return n("AppView.addMapTag"),"left"===t&&(i=this.leftInfo),"right"===t&&(i=this.rightInfo),a="<b><i>"+i.mapName+"</i></b>",e={"no.disp":"no range adaptation","real.disp":"range adaptation"},a="baseline"===i.degs?"baseline "+a+" distribution":"<b>"+i.confidence+"</b> percentile projections for "+a+" at <b>+"+i.degs+"&deg;C</b> with <b>"+e[i.range]+"</b>","left"===t&&this.leftTag.find(".leftlayername").html(a),"right"===t?this.rightTag.find(".rightlayername").html(a):void 0},addMapLayer:function(t){var e,i,a,s,o,l,r,p,c,h,d,g;return n("AppView.addMapLayer"),"left"===t&&(c=this.leftInfo),"right"===t&&(c=this.rightInfo),i="",r="",g="",o=c.mapName.startsWith("Richness -"),s=c.mapName.startsWith("Refugia -"),a=c.mapName.startsWith("Concern -"),o?(h="taxa-richness-change",p="prop.richness_"+c.degs+"_"+c.range+"_"+c.confidence,"baseline"===c.degs&&(p="current.richness",h="taxa-richness")):s?(h="taxa-refugia",p="refuge.certainty_"+c.degs+"_"+c.range,"baseline"===c.degs&&(p="current.richness")):a?(h="taxa-aoc",p="AreaOfConcern.certainty_"+c.degs+"_"+c.range,"baseline"===c.degs&&(p="current.richness")):(h="spp-suitability-purple",p="TEMP_"+c.degs+"_"+c.confidence+"."+c.range,"baseline"===c.degs&&(p="current")),l=this.mapList[this.nameIndex[c.mapName]],l?(d=this.speciesDataUrl,e=".tif","climate"===l.type?(d=this.climateDataUrl,e=".asc"):"richness"===l.type&&(d=this.summariesDataUrl),r=[this.resolvePlaceholders(d,{path:l.path}),p+e].join("/")):console.log("Can't map that -- no '"+c.mapName+"' in index"),$.ajax({url:"/api/preplayer/",method:"POST",data:{info:l,proj:p}}).done(function(e){return function(i){var a,n,s,o;return console.log(["layer prepped, answer is ",i]),o=i.mapUrl,s=i.layerName,a=L.tileLayer.wms(o,{layers:s,format:"image/png",styles:h,transparent:!0}),n=""+t+"loading",a.on("loading",function(){return e.$el.addClass(n)}),a.on("load",function(){return e.$el.removeClass(n)}),"left"===t&&(e.leftLayer&&e.map.removeLayer(e.leftLayer),e.leftLayer=a),"right"===t&&(e.rightLayer&&e.map.removeLayer(e.rightLayer),e.rightLayer=a),a.addTo(e.map),e.legend.update({uri:"/static/images/legends/"+h+".sld.svg"}),e.resizeThings()}}(this)).fail(function(t){return function(t,e){return n(e,"warning")}}(this))},centreMap:function(t){var e,i,a,s;for(n("AppView.centreMap"),t||(t=500),i=function(t){return function(){return t.map.invalidateSize(!1),t.resizeThings()}}(this),s=[],e=a=0;t>=a;e=a+=25)s.push(setTimeout(i,e));return s},toggleForms:function(){return n("AppView.toggleForms"),this.$el.toggleClass("showforms"),this.centreMap()},toggleSplitter:function(){return n("AppView.toggleSplitter"),this.$el.toggleClass("split"),this.$el.hasClass("split")?this.activateSplitter():this.deactivateSplitter(),this.centreMap()},toggleSync:function(){return n("AppView.toggleSync"),this.$("#sync")[0].checked?(this.$(".rightmapspp").prop("disabled",!0),this.copySppToRightSide()):this.$(".rightmapspp").prop("disabled",!1)},buildForm:function(t){var e;return n("AppView.buildForm"),e=this.$("#"+t+"mapspp"),e.autocomplete({close:function(e){return function(){return e.$el.trigger(""+t+"mapupdate")}}(this),source:function(t){return function(e,i){return $.ajax({url:"/api/mapsearch/",data:{term:e.term},success:function(e){var a,n,s;s=[];for(n in e)a=e[n],s.push(n),t.mapList[a.mapId]=a,t.nameIndex[n]=a.mapId;return console.log(e),console.log(s),i(s)}})}}(this)})},startSplitterTracking:function(){return n("AppView.startSplitterTracking"),this.trackSplitter=!0,this.splitLine.addClass("dragging"),this.locateSplitter()},locateSplitter:function(){return n("AppView.locateSplitter"),this.trackSplitter?(this.resizeThings(),0===this.trackSplitter?this.trackSplitter=!1:this.trackSplitter!==!0&&(this.trackSplitter-=1),setTimeout(this.locateSplitter,this.trackPeriod)):void 0},resizeThings:function(){var t,e,i,a,s,o,l,r,p,c,h,d,g,u;if(n("AppView.resizeThings"),this.leftLayer&&(o=$(this.leftLayer.getContainer())),this.rightLayer&&(c=$(this.rightLayer.getContainer())),this.$el.hasClass("split")){if(p=this.splitThumb.position().left+this.splitThumb.width()/2,r=this.map.getContainer(),t=$(r),l=r.getBoundingClientRect(),u=this.map.containerPointToLayerPoint([0,0]),d=this.map.containerPointToLayerPoint([p,0]),e=this.map.containerPointToLayerPoint([t.width(),t.height()]),a=u.y,i=e.y,g=d.x-l.left,s=u.x-l.left,h=e.x,this.splitLine.css("left",p),this.leftTag.attr("style","clip: rect(0, "+p+"px, auto, 0)"),this.leftLayer&&o.attr("style","clip: rect("+a+"px, "+g+"px, "+i+"px, "+s+"px)"),this.rightLayer)return c.attr("style","clip: rect("+a+"px, "+h+"px, "+i+"px, "+g+"px)")}else if(this.leftTag.attr("style","clip: inherit"),this.leftLayer&&o.attr("style","clip: inherit"),this.rightLayer)return c.attr("style","clip: rect(0,0,0,0)")},stopSplitterTracking:function(){return n("AppView.stopSplitterTracking"),this.splitLine.removeClass("dragging"),this.trackSplitter=5},activateSplitter:function(){return n("AppView.activateSplitter"),this.splitThumb.draggable({containment:$("#mapwrapper"),scroll:!1,start:this.startSplitterTracking,drag:this.resizeThings,stop:this.stopSplitterTracking}),this.resizeThings()},deactivateSplitter:function(){return n("AppView.deactivateSplitter"),this.splitThumb.draggable("destroy"),this.resizeThings()}},{templates:{layout:_.template('<div clas="ui-front"></div>\n<div class="splitline">&nbsp;</div>\n<div class="splitthumb"><span>&#x276e; &#x276f;</span></div>\n<div class="left tag"><%= leftTag %></div>\n<div class="right tag"><%= rightTag %></div>\n<div class="left side form"><%= leftForm %></div>\n<div class="right side form"><%= rightForm %></div>\n<div class="left loader"><img src="/static/images/spinner.loadinfo.net.gif" /></div>\n<div class="right loader"><img src="/static/images/spinner.loadinfo.net.gif" /></div>\n<div id="mapwrapper"><div id="map"></div></div>'),leftTag:_.template('<div class="show">\n    <span class="leftlayername">plain map</span>\n    <br>\n    <button class="btn-change">settings</button>\n    <button class="btn-compare">show/hide comparison map</button>\n</div>\n<div class="edit">\n    <label class="left syncbox"></label>\n    <input id="leftmapspp" class="left" type="text" name="leftmapspp" placeholder="&hellip; species or group &hellip;" />\n</div>'),rightTag:_.template('<div class="show">\n    <span class="rightlayername">(no distribution)</span>\n    <br>\n    <button class="btn-change">settings</button>\n    <button class="btn-compare">show/hide comparison map</button>\n</div>\n<div class="edit">\n    <label class="right syncbox"><input id="sync" type="checkbox" value="sync" checked="checked" /> same as left side</label>\n    <input id="rightmapspp" type="text" class="right" name="rightmapspp" placeholder="&hellip; species or group &hellip;" />\n</div>'),leftForm:_.template('<fieldset>\n    <legend>temperature change</legend>\n    <select class="left" id="leftmapdegs">\n        <option value="baseline">baseline</option>\n        <option value="1.5">1.5 &deg;C</option>\n        <option value="2">2.0 &deg;C</option>\n        <option value="2.7">2.7 &deg;C</option>\n        <option value="3.2">3.2 &deg;C</option>\n        <option value="4.5">4.5 &deg;C</option>\n        <optgroup label="High sensitivity climate">\n            <option value="6">6.0 &deg;C</option>\n        </optgroup>\n    </select>\n</fieldset>\n<fieldset>\n    <legend>adaptation via range shift</legend>\n    <label><!-- span>none</span --> <input name="leftmaprange" class="left" type="radio" value="no.disp" checked="checked"> species cannot shift ranges</label>\n    <label><!-- span>allow</span --> <input name="leftmaprange" class="left" type="radio" value="real.disp"> allow range adaptation</label>\n</fieldset>\n<fieldset>\n    <legend>model summary</legend>\n    <select class="left" id="leftmapconfidence">\n        <option value="10">10th percentile</option>\n        <!-- option value="33">33rd percentile</option -->\n        <option value="50" selected="selected">50th percentile</option>\n        <!-- option value="66">66th percentile</option -->\n        <option value="90">90th percentile</option>\n    </select>\n</fieldset>\n<fieldset class="blank">\n    <button type="button" class="btn-change">hide settings</button>\n    <button type="button" class="btn-compare">hide/show right map</button>\n    <button type="button" class="btn-copy right-valid-map">copy right map &laquo;</button>\n    <a id="leftmapdl" class="download left-valid-map" href="" disabled="disabled">download just this map<br>(<1Mb GeoTIFF)</a>\n</fieldset>\n'),rightForm:_.template('<fieldset>\n    <legend>temperature change</legend>\n    <select class="right" id="rightmapdegs">\n        <option value="baseline">baseline</option>\n        <option value="1.5">1.5 &deg;C</option>\n        <option value="2">2.0 &deg;C</option>\n        <option value="2.7">2.7 &deg;C</option>\n        <option value="3.2">3.2 &deg;C</option>\n        <option value="4.5">4.5 &deg;C</option>\n        <optgroup label="High sensitivity climate">\n            <option value="6">6.0 &deg;C</option>\n        </optgroup>\n    </select>\n</fieldset>\n<fieldset>\n    <legend>adaptation via range shift</legend>\n    <label><!-- span>none</span --> <input name="rightmaprange" class="right" type="radio" value="no.disp" checked="checked"> species cannot shift ranges</label>\n    <label><!-- span>allow</span --> <input name="rightmaprange" class="right" type="radio" value="real.disp"> allow range adaptation</label>\n</fieldset>\n<fieldset>\n    <legend>model summary</legend>\n    <select class="right" id="rightmapconfidence">\n        <option value="10">10th percentile</option>\n        <!-- option value="33">33rd percentile</option -->\n        <option value="50" selected="selected">50th percentile</option>\n        <!-- option value="66">66th percentile</option -->\n        <option value="90">90th percentile</option>\n    </select>\n</fieldset>\n<fieldset class="blank">\n    <button type="button" class="btn-change">hide settings</button>\n    <button type="button" class="btn-compare">hide/show right map</button>\n    <button type="button" class="btn-copy left-valid-map">copy left map &laquo;</button>\n    <a id="rightmapdl" class="download right-valid-map" href="" disabled="disabled">download just this map<br>(<1Mb GeoTIFF)</a>\n</fieldset>\n')}}),e.exports=i}).call(this)},{"../models/maplayer":3,"../util/shims":4}],6:[function(t,e,i){!function(t,e,i,a){t.widget("climas.mspp",{options:{animationFactor:2,mainMenuClass:"mspp-main-menu",panelClass:"mspp-panel",pageClass:"mspp-page",clearfixClass:"mspp-clearfix",activeClass:"current"},_create:function(){var e=this,i=this.options,a=this.element;this.mainMenuItems=a.children("li"),this.panels=t("."+i.panelClass),a.css({opacity:0}),this.panels.css({opacity:0}),a.addClass(i.mainMenuClass),a.addClass(i.clearfixClass),this.panels.addClass(i.clearfixClass),this._layoutMenu(),this._layoutPanels(),a.on("msppshowmenu",this._showMenu),a.on("msppshowsubmenu",this._showSubMenu),a.on("msppshowpanel",this._showPanel),a.on("msppshowpage",this._showPage),this.mainMenuItems.each(function(i,a){t(a).children("a").click(function(t){e._trigger("showmenu",t,{menuitem:a,widget:e})}),t(a).find("li").each(function(i,n){t(n).find("a").click(function(t){e._trigger("showsubmenu",t,{menuitem:a,submenuitem:n,widget:e})})})}),a.find("[data-targetpanel]").each(function(i,a){var n=t(a);n.click(function(i){e._trigger("showpanel",i,{panel:t("#"+n.data("targetpanel")).first(),widget:e})})}),this.panels.each(function(i,a){var n=t(a);n.find("[data-targetpage]").click(function(i){e._trigger("showpage",i,{panel:n,page:t("#"+t(this).data("targetpage")),widget:e})})});var n=this.mainMenuItems.filter("."+i.activeClass);n.removeClass(i.activeClass).children("a").click(),a.animate({opacity:1},"fast")},_switchClassOption:function(t,e){var i=this.options[t];if(i!==e){var a=this.element.find("."+i);this.options[t]=e,a.removeClass(i),a.addClass(e)}},_setOption:function(t,e){switch(t){case"mainMenuClass":case"clearfixClass":case"activeClass":this._switchClassOption(t,e);break;default:this.options[t]=e}this._super("_setOption",t,e)},_destroy:function(){this.element.removeClass(this.options.mainMenuClass),this.element.removeClass(this.options.clearfixClass),this.panels.removeClass(this.options.clearfixClass)},_layoutMenu:function(){this.element.find("ul").each(function(e,i){var a=t(i);a.css({width:"auto"}),a.data("originalWidth",a.width()),a.css({width:0,display:"none"})})},_showMenu:function(e,i){var a=t(i.menuitem),n=i.widget;if(a.hasClass(n.options.activeClass));else{n._hidePanels(),n.mainMenuItems.removeClass(n.options.activeClass);var s=a.find("ul"),o=n.element.find("ul").not(s),l=s.data("originalWidth");o.animate({width:0},50*n.options.animationFactor,function(){o.css({display:"none"})}),a.addClass(n.options.activeClass),s.css({display:"block"}).animate({width:l},125*n.options.animationFactor,function(){s.css({width:"auto"}).removeAttr("style"),n._trigger("menushown",e,{item:a,widget:n})}),s.find("."+n.options.activeClass+" a").click()}},_showSubMenu:function(e,i){t(i.menuitem).find("li").removeClass(i.widget.options.activeClass),t(i.submenuitem).addClass(i.widget.options.activeClass)},_layoutPanels:function(){var e=this.panels.find("."+this.options.pageClass);e.each(function(e,i){var a=t(i);a.css({height:"auto"}),a.data("originalHeight",a.outerHeight()),a.css({height:0,display:"none"})}),this.panels.each(function(e,i){var a=t(i);a.css({display:"none"})})},_hidePanels:function(){this.panels.removeClass(this.options.activeClass).css({display:"none",height:0})},_showPanel:function(e,i){var a=t(i.panel),n=i.widget;if(a.hasClass(n.options.activeClass));else{n._hidePanels(),a.addClass(n.options.activeClass),a.css({display:"block",opacity:1});var s=t(a.find("."+n.options.pageClass+"."+n.options.activeClass));n._trigger("showpage",e,{panel:a,page:s,widget:n})}},_showPage:function(e,i){var a=i.widget,n=t(i.panel),s=t(i.page),o=s.data("originalHeight");n.css({height:n.height()});var l=n.find("."+a.options.pageClass+"."+a.options.activeClass).not(s);l.length>0&&(l.data("originalHeight",l.outerHeight()),l.removeClass(a.options.activeClass).fadeOut(50*a.options.animationFactor,function(){l.css({height:0})})),s.css({height:"auto"}).addClass(a.options.activeClass).fadeIn(100*a.options.animationFactor,function(){s.removeAttr("style")});var r=l.length>0?100*a.options.animationFactor:150*a.options.animationFactor;n.animate({height:o},r,function(){n.removeAttr("style")})},_:null})}(jQuery,window,document)},{}]},{},[1]);